<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8"/>
  <title>TimVideos.us Planet - Developers News</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <meta name="description" content="News from our best developers, all news aggregated by planet."/>
  <link rel="alternate" type="application/atom+xml" title="Tim Videos Planet Feed" href="/feed.xml" />
  <link rel="canonical" href="http://planet.timvideos.us/iframe/gsoc-2014/2014/05/30/padmonitor-py-ported//">
  <link href="/css/jquery.fancybox.css?v=2.1.5" rel="stylesheet"/>
  <link href="/css/bootstrap.min.css" rel="stylesheet" />
  <link href="/css/font-awesome.min.css" rel="stylesheet" />
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="/css/styles.css" rel="stylesheet" />
</head>
  <body>
    <div class="wrapper">
      <div class="box">
        <div class="row">
          <div class="column col-sm-12 col-md-12 col-lg-12" id="main">
            <div class="padding">
              <div class="col-sm-12">
  <div class="panel panel-default" id="featured">
    <div class="panel-body">
      
        <h4>gsoc-2014</h4>
      
      <h1>padmonitor.py ported</h1>
      <div class="article">
        <p class="meta description">
          May 30, 2014
           • Amanpreet (Porting Flumotion)
          
        </p>
        
          <p class="tags">
            <span>Tags: </span>
            
              <span class="label label-tag">
                <a href="/iframe/tags/news">
                  news
                </a>
              </span>
            
              <span class="label label-tag">
                <a href="/iframe/tags/flumotion">
                  flumotion
                </a>
              </span>
            
          </p>
        
        <p class="share-buttons">
  <span>Share: </span>
  <span class="share-button"><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fplanet.timvideos.us%2Fiframe%2Fgsoc-2014%2F2014%2F05%2F30%2Fpadmonitor-py-ported%2F" target="_blank"><i class="fa fa-facebook-square fa-2x"></i></a></span>
  <span class="share-button"><a href="https://twitter.com/intent/tweet?source=http%3A%2F%2Fplanet.timvideos.us%2Fiframe%2Fgsoc-2014%2F2014%2F05%2F30%2Fpadmonitor-py-ported%2F&text=TimVideos.us%20padmonitor.py+ported%20http%3A%2F%2Fplanet.timvideos.us%2Fiframe%2Fgsoc-2014%2F2014%2F05%2F30%2Fpadmonitor-py-ported%2F" target="_blank" title="Tweet"><i class="fa fa-twitter-square fa-2x"></i></a></span>
  <span class="share-button"><a href="https://plus.google.com/share?url=http%3A%2F%2Fplanet.timvideos.us%2Fiframe%2Fgsoc-2014%2F2014%2F05%2F30%2Fpadmonitor-py-ported%2F" target="_blank" title="Share on Google+"><i class="fa fa-google-plus-square fa-2x"></i></a></span>
</p>
        <p class="article">
          <p>I did the required changes and hence, flumotion/component/padmonitor.py is ported and tests pass:</p>

<div class="highlight"><pre><code class="bash">flumotion.test.test_component_padmonitor
  TestPadMonitor
    testPadMonitorActivation ...                                           <span class="o">[</span>OK<span class="o">]</span>
    testPadMonitorTimeout ...                                              <span class="o">[</span>OK<span class="o">]</span>

-------------------------------------------------------------------------------
Ran 2 tests in 0.663s

PASSED <span class="o">(</span><span class="nv">successes</span><span class="o">=</span>2<span class="o">)</span>
</code></pre></div>

<p>I faced some problems and following is what I did to fix them:</p>

<h3 id="section">1</h3>

<p>While changing <a href="https://github.com/aps-sids/flumotion-orig/commit/be7714ab8a0ce4be743d670a969ab4b1f0f5ca06#diff-47651c297ba46f72039cff6584808cf6L35">this line</a> code, as per <a href="http://gstreamer.freedesktop.org/data/doc/gstreamer/head/gstreamer/html/GstBus.html#gst-bus-poll">Gstreamer docs</a>, if maximum time to poll is negative(-1), this function will block indefinitely. But, keeping the value -1 gives the error:</p>

<div class="highlight"><pre><code class="bash"><span class="o">===============================================================================</span>
<span class="o">[</span>ERROR<span class="o">]</span>
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;/home/aps/workspace/gsoc/flumotion-orig/flumotion/test/test_component_padmonitor.py&quot;</span>, line 51, in testPadMonitorActivation
    self._run_pipeline<span class="o">(</span>pipeline<span class="o">)</span>
  File <span class="s2">&quot;/home/aps/workspace/gsoc/flumotion-orig/flumotion/test/test_component_padmonitor.py&quot;</span>, line 37, in _run_pipeline
    pipeline.get_bus<span class="o">()</span>.poll<span class="o">(</span>Gst.MessageType.EOS, Gst.CLOCK_TIME_NONE<span class="o">)</span>
  File <span class="s2">&quot;/usr/lib/python2.7/dist-packages/gi/types.py&quot;</span>, line 43, in <span class="k">function</span>
<span class="k">    return </span>info.invoke<span class="o">(</span>*args, **kwargs<span class="o">)</span>
exceptions.ValueError: -1 not in range 0 to 18446744073709551615
</code></pre></div>

<p>So, reading some other documentation suggests me to use Gst.CLOCK_TIME_NONE in place of -1. Now, another problem. Value of Gst.CLOCK_TIME_NONE should be and is 18446744073709551615L on Gstreamer 1.2.4 on Ubuntu 14.04. But, on my system (Ubuntu 12.04, Gstreamer 1.2.1) I get value as -1. I’m not able to install any Gstreamer version newer than 1.2.1 either (I don’t think its available on Ubuntu 12.04 precise). Hence, to fix this, I’m manually putting in the correct value as an argument.</p>

<h3 id="section-1">2</h3>

<p>Again, due to this Gstreamer version problem, a function Gst.TIME_ARGS is not available. So, I’m writing that myself here:</p>

<div class="highlight"><pre><code class="python"><span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Gst</span><span class="p">,</span> <span class="s">&#39;TIME_ARGS&#39;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">TIME_ARGS</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">==</span> <span class="n">Gst</span><span class="o">.</span><span class="n">CLOCK_TIME_NONE</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;CLOCK_TIME_NONE&#39;</span>

        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%u</span><span class="s">:</span><span class="si">%02u</span><span class="s">:</span><span class="si">%02u</span><span class="s">.</span><span class="si">%09u</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span> <span class="o">/</span> <span class="p">(</span><span class="n">Gst</span><span class="o">.</span><span class="n">SECOND</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">),</span>
                                      <span class="p">(</span><span class="n">time</span> <span class="o">/</span> <span class="p">(</span><span class="n">Gst</span><span class="o">.</span><span class="n">SECOND</span> <span class="o">*</span> <span class="mi">60</span><span class="p">))</span> <span class="o">%</span> <span class="mi">60</span><span class="p">,</span>
                                      <span class="p">(</span><span class="n">time</span> <span class="o">/</span> <span class="p">(</span><span class="n">Gst</span><span class="o">.</span><span class="n">SECOND</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span><span class="p">),</span>
                                      <span class="n">time</span> <span class="o">%</span> <span class="n">Gst</span><span class="o">.</span><span class="n">SECOND</span><span class="p">)</span>

    <span class="n">Gst</span><span class="o">.</span><span class="n">TIME_ARGS</span> <span class="o">=</span> <span class="n">TIME_ARGS</span>
</code></pre></div><div class="author">
  <span>
    <i>Originally posted on <a href="http://aps-sids.github.io/porting-flumotion">Porting Flumotion - GSoC '14 Progress Blog</a></i>
  </span>
</div>

        </p>
      </div>
    </div>
  </div>
</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.fancybox.pack.js?v=2.1.5"></script>
<script src="/js/planet.js"></script>

  </body>
</html>