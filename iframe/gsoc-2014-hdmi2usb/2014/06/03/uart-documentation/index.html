<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <title>TimVideos.us Planet - Developers News</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="News from our best developers, all news aggregated by planet.">
  <link rel="alternate" type="application/atom+xml" title="Tim Videos Planet Feed" href="/feed.xml" />
  <link rel="canonical" href="http://planet.timvideos.us/iframe/gsoc-2014-hdmi2usb/2014/06/03/uart-documentation/">
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/font-awesome.min.css" rel="stylesheet">
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="/css/styles.css" rel="stylesheet">
</head>
  <body>
    <div class="wrapper">
      <div class="box">
        <div class="row">
          <div class="column col-sm-12 col-md-12 col-lg-12" id="main">
            <div class="padding">
              <div class="col-sm-12">
  <div class="panel panel-default" id="featured">
    <div class="panel-body">
      
        <h4>gsoc-2014-hdmi2usb</h4>
      
      <h1>UART Documentation</h1>
      <div class="article">
        <p class="meta description">
          Jun 3, 2014
           • Ajit (MJPEG Optimisation)
          
        </p>
        
          <p class="tags">
            <span>Tags: </span>
            
              <span class="label label-tag">
                news
              </span>
            
              <span class="label label-tag">
                hdmi2usb
              </span>
            
              <span class="label label-tag">
                mjpeg
              </span>
            
          </p>
        
        <p class="article">
          <div dir="ltr" style="text-align: left;" trbidi="on"><span style="font-family: Georgia, Times New Roman, serif;">Atlys board has a UART-USB bridge which can be used for UART communication with other devices. UART is useful as a debug so I have made a simple UART.</span><br /><span style="font-family: Georgia, Times New Roman, serif;"><br /></span><span style="font-family: Georgia, Times New Roman, serif;">Features:</span><br /><span style="font-family: Georgia, Times New Roman, serif;"><span style="text-indent: -0.25in;">1.</span><span style="font-variant: small-caps; text-indent: -0.25in;">Variable Data Bits: 7</span><span style="font-variant: small-caps; text-indent: -0.25in;">, 8, or 9 data bits and 1 or 2 stop bits</span></span><br /><span style="font-family: Georgia, Times New Roman, serif;"><span style="text-indent: -0.25in;">2.</span><span style="font-variant: small-caps; text-indent: -0.25in;">Parity </span><span style="font-variant: small-caps; text-indent: -0.25in;">generation and checking: odd, even, or none.</span></span><br /><span style="font-family: Georgia, Times New Roman, serif;"><span style="text-indent: -0.25in;">3.</span><span style="font-variant: small-caps; text-indent: -0.25in;">One transmit and one receive data buffer.</span></span><br /><span style="font-family: Georgia, Times New Roman, serif;"><span style="text-indent: -0.25in;">4.</span><span style="font-variant: small-caps; text-indent: -0.25in;">Received </span><span style="font-variant: small-caps; text-indent: -0.25in;">data and status can optionally be read from a single </span><span style="font-variant: small-caps; text-indent: -0.25in;">register</span></span><br /><span style="font-family: Georgia, Times New Roman, serif;"><span style="text-indent: -0.25in;">5.</span><span style="font-variant: small-caps; text-indent: -0.25in;">Built-in Baud Rate Generator</span><span style="font-variant: small-caps; text-indent: -0.25in;">.</span></span><br /><span style="font-family: Georgia, Times New Roman, serif;"><span style="text-indent: -0.25in;">6.</span><span style="font-variant: small-caps; text-indent: -0.25in;">Variable </span><span style="font-variant: small-caps; text-indent: -0.25in;">Baudrates</span><span style="font-variant: small-caps; text-indent: -0.25in;">. Use case: 19,200</span></span><br /><span style="font-family: Georgia, Times New Roman, serif;"><span style="text-indent: -0.25in;">7.</span><span style="font-variant: small-caps; text-indent: -0.25in;"> Data is received in frame.</span></span><br /><span style="text-indent: -0.25in; text-transform: uppercase;"><span style="font-family: Georgia, Times New Roman, serif;"><br /></span></span><span style="text-indent: -0.25in; text-transform: uppercase;"><span style="font-family: Georgia, Times New Roman, serif;">Architecture</span></span><br /><span style="font-family: Georgia, Times New Roman, serif;"><span style="text-indent: -0.23in;">•</span><span style="font-variant: small-caps; text-indent: -0.23in;">UART Transmitter</span></span><br /><span style="font-family: Georgia, Times New Roman, serif;"><span style="font-variant: small-caps; text-indent: 0in;">&nbsp;It</span><span style="font-variant: small-caps; text-indent: 0in;">&nbsp;has 3 major components:</span></span><br /><span style="font-family: Georgia, Times New Roman, serif;"><span style="text-indent: -0.56in;">1.</span><span style="font-variant: small-caps; text-indent: -0.56in;">FIFO </span><span style="font-variant: small-caps; text-indent: -0.56in;">Buffer</span></span><br /><span style="font-family: Georgia, Times New Roman, serif;"><span style="text-indent: -0.56in;">2.</span><span style="font-variant: small-caps; text-indent: -0.56in;">Baudrate </span><span style="font-variant: small-caps; text-indent: -0.56in;">Generator</span></span><br /><span style="font-family: Georgia, Times New Roman, serif;"><span style="text-indent: -0.56in;">3.</span><span style="font-variant: small-caps; text-indent: -0.56in;">Transmitter </span><span style="font-variant: small-caps; text-indent: -0.56in;">interface </span><span style="font-variant: small-caps; text-indent: -0.56in;">circuit</span></span><br /><span style="text-indent: -0.23in;"><span style="font-family: Georgia, Times New Roman, serif;"><br /></span></span><span style="font-family: Georgia, Times New Roman, serif;"><span style="text-indent: -0.23in;">•</span><span style="font-variant: small-caps; text-indent: -0.23in;">UART Receiver</span><span style="font-variant: small-caps; text-indent: -0.23in;">:</span></span><br /><span style="font-family: Georgia, Times New Roman, serif;"><span style="font-variant: small-caps; text-indent: 0in;">&nbsp;</span><span style="font-variant: small-caps; text-indent: 0in;">It has 3 major components:</span></span><br /><span style="font-family: Georgia, Times New Roman, serif;"><span style="text-indent: -0.56in;">1.</span><span style="font-variant: small-caps; text-indent: -0.56in;">Baudrate Generato</span><span style="font-variant: small-caps; text-indent: -0.56in;">r</span></span><br /><span style="font-family: Georgia, Times New Roman, serif;"><span style="text-indent: -0.56in;">2.</span><span style="font-variant: small-caps; text-indent: -0.56in;">Receiver interface circuit</span></span><br /><span style="font-family: Georgia, Times New Roman, serif;"><span style="text-indent: -0.56in;">3.</span><span style="font-variant: small-caps; text-indent: -0.56in;">FIFO Buffer&nbsp;</span></span><br /><br /><span style="text-transform: uppercase;"><span style="font-family: Times, Times New Roman, serif;">Primary Inputs/Outputs</span></span><br /><div style="direction: ltr; margin-bottom: 4.5pt; margin-left: 0.23in; margin-top: 4.08pt; text-indent: -0.23in; unicode-bidi: embed; word-break: normal;"><span style="font-family: Times, Times New Roman, serif;">•<span style="font-variant: small-caps; font-weight: bold;">Inputs</span></span></div><div style="direction: ltr; margin-bottom: 4.5pt; margin-left: 0.23in; margin-top: 4.08pt; text-indent: -0.23in; unicode-bidi: embed; word-break: normal;"><span style="font-family: Times, Times New Roman, serif;"><span style="text-indent: -0.38in;">1.</span><span style="font-variant: small-caps; text-indent: -0.38in;">clk,reset</span></span></div><div style="direction: ltr; margin-bottom: 4.5pt; margin-left: 0.23in; margin-top: 4.08pt; text-indent: -0.23in; unicode-bidi: embed; word-break: normal;"><span style="font-family: Times, Times New Roman, serif;"><span style="text-indent: -0.38in;">2.WIRE[7:0] W_DATA</span><span style="font-variant: small-caps; text-indent: -0.38in;">&nbsp;- DATA INPUT TO TRANSMITTER FIFO</span><span style="font-variant: small-caps; text-indent: -0.38in;"><br /></span></span></div><div style="direction: ltr; margin-bottom: 4.5pt; margin-left: 0.23in; margin-top: 4.08pt; text-indent: -0.23in; unicode-bidi: embed; word-break: normal;"><span style="font-family: Times, Times New Roman, serif;"><span style="text-indent: -0.38in;">3.WIRE Wr_UART</span><span style="font-variant: small-caps; text-indent: -0.38in;">- WHEN SET TO HIGH W_DATA IS WRITTEN INTO TRANSMITTER FIFO&nbsp;</span></span></div><div style="direction: ltr; margin-bottom: 4.5pt; margin-left: 0.23in; margin-top: 4.08pt; text-indent: -0.23in; unicode-bidi: embed; word-break: normal;"><span style="font-family: Times, Times New Roman, serif;"><span style="text-indent: -0.38in;">4.WIRE Rx</span><span style="font-variant: small-caps; text-indent: -0.38in;">&nbsp;- UART RECIEVER LINE</span></span></div><div style="direction: ltr; margin-bottom: 4.5pt; margin-left: 0.23in; margin-top: 4.08pt; text-indent: -0.23in; unicode-bidi: embed; word-break: normal;"><span style="font-family: Times, Times New Roman, serif;"><span style="text-indent: -0.38in;">5.WIRE RD_UART</span><span style="font-variant: small-caps; text-indent: -0.38in;">- READS &nbsp;THE DATA FROMP FIFO</span></span></div><div style="direction: ltr; margin-bottom: 4.5pt; margin-left: 0.23in; margin-top: 4.08pt; text-indent: -0.23in; unicode-bidi: embed; word-break: normal;"><span style="font-family: Times, Times New Roman, serif;">•<span style="font-variant: small-caps; font-weight: bold;">Outputs</span></span></div><div style="direction: ltr; margin-bottom: 4.5pt; margin-left: 0.23in; margin-top: 4.08pt; text-indent: -0.23in; unicode-bidi: embed; word-break: normal;"><span style="font-family: Times, 'Times New Roman', serif; text-indent: -0.38in;">1.</span><span style="font-family: Times, 'Times New Roman', serif; font-variant: small-caps; text-indent: -0.38in;">WIRE TX_FULL- HIGH WHEN TX FIFO IS FULL</span></div><div style="direction: ltr; margin-bottom: 4.5pt; margin-left: 0.23in; margin-top: 4.08pt; text-indent: -0.23in; unicode-bidi: embed; word-break: normal;"><span style="font-family: Times, 'Times New Roman', serif; text-indent: -0.38in;">2.</span><span style="font-family: Times, 'Times New Roman', serif; font-variant: small-caps; text-indent: -0.38in;">WIRE TX- UART TRANSMITTER LINE</span></div><div style="direction: ltr; margin-bottom: 4.5pt; margin-left: 0.23in; margin-top: 4.08pt; text-indent: -0.23in; unicode-bidi: embed; word-break: normal;"><span style="font-family: Times, 'Times New Roman', serif; text-indent: -0.38in;">3.</span><span style="font-family: Times, 'Times New Roman', serif; font-variant: small-caps; text-indent: -0.38in;">WIRE RX_EMPTY- HIGH WHEN RX FIFO IS EMPTY</span></div><div style="direction: ltr; margin-bottom: 4.5pt; margin-left: 0.23in; margin-top: 4.08pt; text-indent: -0.23in; unicode-bidi: embed; word-break: normal;"><span style="font-family: Times, 'Times New Roman', serif; text-indent: -0.38in;">4.</span><span style="font-family: Times, 'Times New Roman', serif; font-variant: small-caps; text-indent: -0.38in;">WIRE R_DATA- OUPUT FROM RX FIFO</span></div><div style="direction: ltr; margin-bottom: 4.5pt; margin-left: 0.23in; margin-top: 4.08pt; text-indent: -0.23in; unicode-bidi: embed; word-break: normal;"><span style="font-family: Times, 'Times New Roman', serif; font-variant: small-caps; text-indent: -0.38in;"><br /></span></div><div style="direction: ltr; margin-bottom: 4.5pt; margin-left: 0.23in; margin-top: 4.08pt; text-indent: -36.480003356933594px; unicode-bidi: embed; word-break: normal;"><span style="font-family: Times, Times New Roman, serif;"><span style="font-variant: small-caps;">FSM for Reciever</span></span></div><div style="direction: ltr; margin-bottom: 4.5pt; margin-left: 0.23in; margin-top: 4.08pt; text-indent: -36.480003356933594px; unicode-bidi: embed; word-break: normal;"><span style="font-family: Times, Times New Roman, serif;"><span style="font-variant: small-caps;"><br /></span></span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/--a3sZ0tgq8k/U44huOZQpgI/AAAAAAAAAMw/cWfDMJSun0Q/s1600/FSM.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/--a3sZ0tgq8k/U44huOZQpgI/AAAAAAAAAMw/cWfDMJSun0Q/s1600/FSM.JPG" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">As the communication is asynchronous, data is oversampled. Each bit is oversampled 16 times. Oversampling is done using a mod m counter.</div><div class="separator" style="clear: both; text-align: left;">As the circuit is oversampling, I am running UART at 50 MHz which is generated using PLL.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><b>How To Use?</b><span style="font-family: Times, Times New Roman, serif;"><span style="font-variant: small-caps;"><br /></span></span></div><br /><div class="separator" style="clear: both; text-align: left;"></div><ul style="text-align: left;"><li>Add UART files to your design file.</li><li>Add UART_clock.xco. You may have to regenerate the core depending on you design.</li><li>Set paramerters of UART_main.</li><ul><li>Data_Bits=8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// No. of data bits</li><li>StopBit_ticks = 16 &nbsp; &nbsp; &nbsp; &nbsp;// No. of ticks for stop bits. 16/24/32 for 1/1.5/2 bits</li><li>DIVSIOR = 326 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Use it to set baud rate. Divisor= 50/(16*BaudRate)</li><li>DVSR_BIT=8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// No. of bits of Divisor</li><li>FIFO_Add_Bit= 2 &nbsp; &nbsp; &nbsp; &nbsp;// No. of address bits of FIFO</li></ul><li>To transmit data, drive w_data and strobe the wr_uart signal.</li><ul><li>Data will not be written into fifo if tx_full is high</li></ul><li>To dequeue data from receiver fifo, strobe the rd_uart signal.&nbsp;</li><ul><li>Data in receiver is invalid if rx_empty is high</li></ul><li>Add the following lines to your ucf file.</li><li>Download exar driver from&nbsp;<a href="http://www.exar.com/connectivity/uart-and-bridging-solutions/usb-uarts/xr21v1410">here</a><u>&nbsp;</u>and install them.&nbsp;</li><ul><li>NOTE: Turns out that the linux drivers are outdated. Shenki has made changes to it which can be found <a href="https://github.com/shenki/exar-uart-driver/commits?author=shenki">here</a>&nbsp;but I was unable to get it running. I have test the code on windows.</li></ul><li>Use hyperterminal or gtkterm to monitor/send data.</li><li>Enjoy!</li></ul><div><br /></div><br /><div style="direction: ltr; margin-bottom: 4.5pt; margin-left: 0.23in; margin-top: 4.08pt; text-indent: -36.480003356933594px; unicode-bidi: embed; word-break: normal;"><span style="font-family: Times, Times New Roman, serif;"><span style="font-variant: small-caps;"><br /></span></span></div></div><div class="author">
  <span>
    <i>Originally posted on <a href="http://ajitmathewgsoc.blogspot.com/">TimVideo GSoC 2014: MJPEG Optimisation</a></i>
  </span>
</div>

        </p>
      </div>
    </div>
  </div>
</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
  </body>
</html>