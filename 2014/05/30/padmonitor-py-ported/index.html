---
title: "padmonitor.py ported"
kind: article
created_at: 2014-05-30 07:00:00 UTC
author: Amanpreet (Porting Flumotion)
image: https://avatars2.githubusercontent.com/u/2363074?s=50
categories: GSoC-2014
tags: "news flumotion"
layout: post
---<p>I did the required changes and hence, flumotion/component/padmonitor.py is ported and tests pass:</p>

<div class="highlight"><pre><code class="bash">flumotion.test.test_component_padmonitor
  TestPadMonitor
    testPadMonitorActivation ...                                           <span class="o">[</span>OK<span class="o">]</span>
    testPadMonitorTimeout ...                                              <span class="o">[</span>OK<span class="o">]</span>

-------------------------------------------------------------------------------
Ran 2 tests in 0.663s

PASSED <span class="o">(</span><span class="nv">successes</span><span class="o">=</span>2<span class="o">)</span>
</code></pre></div>

<p>I faced some problems and following is what I did to fix them:</p>

<h3 id="section">1</h3>

<p>While changing <a href="https://github.com/aps-sids/flumotion-orig/commit/be7714ab8a0ce4be743d670a969ab4b1f0f5ca06#diff-47651c297ba46f72039cff6584808cf6L35">this line</a> code, as per <a href="http://gstreamer.freedesktop.org/data/doc/gstreamer/head/gstreamer/html/GstBus.html#gst-bus-poll">Gstreamer docs</a>, if maximum time to poll is negative(-1), this function will block indefinitely. But, keeping the value -1 gives the error:</p>

<div class="highlight"><pre><code class="bash"><span class="o">===============================================================================</span>
<span class="o">[</span>ERROR<span class="o">]</span>
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;/home/aps/workspace/gsoc/flumotion-orig/flumotion/test/test_component_padmonitor.py&quot;</span>, line 51, in testPadMonitorActivation
    self._run_pipeline<span class="o">(</span>pipeline<span class="o">)</span>
  File <span class="s2">&quot;/home/aps/workspace/gsoc/flumotion-orig/flumotion/test/test_component_padmonitor.py&quot;</span>, line 37, in _run_pipeline
    pipeline.get_bus<span class="o">()</span>.poll<span class="o">(</span>Gst.MessageType.EOS, Gst.CLOCK_TIME_NONE<span class="o">)</span>
  File <span class="s2">&quot;/usr/lib/python2.7/dist-packages/gi/types.py&quot;</span>, line 43, in <span class="k">function</span>
<span class="k">    return </span>info.invoke<span class="o">(</span>*args, **kwargs<span class="o">)</span>
exceptions.ValueError: -1 not in range 0 to 18446744073709551615
</code></pre></div>

<p>So, reading some other documentation suggests me to use Gst.CLOCK_TIME_NONE in place of -1. Now, another problem. Value of Gst.CLOCK_TIME_NONE should be and is 18446744073709551615L on Gstreamer 1.2.4 on Ubuntu 14.04. But, on my system (Ubuntu 12.04, Gstreamer 1.2.1) I get value as -1. I’m not able to install any Gstreamer version newer than 1.2.1 either (I don’t think its available on Ubuntu 12.04 precise). Hence, to fix this, I’m manually putting in the correct value as an argument.</p>

<h3 id="section-1">2</h3>

<p>Again, due to this Gstreamer version problem, a function Gst.TIME_ARGS is not available. So, I’m writing that myself here:</p>

<div class="highlight"><pre><code class="python"><span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Gst</span><span class="p">,</span> <span class="s">&#39;TIME_ARGS&#39;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">TIME_ARGS</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">==</span> <span class="n">Gst</span><span class="o">.</span><span class="n">CLOCK_TIME_NONE</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;CLOCK_TIME_NONE&#39;</span>

        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%u</span><span class="s">:</span><span class="si">%02u</span><span class="s">:</span><span class="si">%02u</span><span class="s">.</span><span class="si">%09u</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span> <span class="o">/</span> <span class="p">(</span><span class="n">Gst</span><span class="o">.</span><span class="n">SECOND</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">),</span>
                                      <span class="p">(</span><span class="n">time</span> <span class="o">/</span> <span class="p">(</span><span class="n">Gst</span><span class="o">.</span><span class="n">SECOND</span> <span class="o">*</span> <span class="mi">60</span><span class="p">))</span> <span class="o">%</span> <span class="mi">60</span><span class="p">,</span>
                                      <span class="p">(</span><span class="n">time</span> <span class="o">/</span> <span class="p">(</span><span class="n">Gst</span><span class="o">.</span><span class="n">SECOND</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span><span class="p">),</span>
                                      <span class="n">time</span> <span class="o">%</span> <span class="n">Gst</span><span class="o">.</span><span class="n">SECOND</span><span class="p">)</span>

    <span class="n">Gst</span><span class="o">.</span><span class="n">TIME_ARGS</span> <span class="o">=</span> <span class="n">TIME_ARGS</span>
</code></pre></div><div class="author">
  <span>
    <i>Originally posted on <a href="http://aps-sids.github.io/porting-flumotion">Porting Flumotion - GSoC '14 Progress Blog</a></i>
  </span>
</div>
