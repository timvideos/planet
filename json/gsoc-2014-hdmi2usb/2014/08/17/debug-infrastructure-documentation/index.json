{"title":"Debug Infrastructure Documentation","created_at":"2014-08-17 19:55:00 UTC","author":"Ajit (MJPEG Optimisation)","content":"<div dir=\"ltr\" style=\"text-align: left;\" trbidi=\"on\">Debug infrastructure provides an easy interface for a developer to output data from the FPGA board for debugging. It is also useful for end users in case of troubleshooting.<br /><br /><h4 style=\"text-align: left;\">The BIG PICTURE:</h4><div><span id=\"docs-internal-guid-3c2e4da6-e57a-1e7f-99d8-25e94f272ef1\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\"><img height=\"275px;\" src=\"https://docs.google.com/drawings/d/sWiUs9sKILX1TDoZ4QiVsLw/image?w=759&amp;h=275&amp;rev=39&amp;ac=1\" style=\"-webkit-transform: rotate(0.00rad); border: none; transform: rotate(0.00rad);\" width=\"759px;\" /></span></span></div><div><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\"><br /></span></div><div><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">The debug data is collected into the debug_module which then breaks the data into bytes and sends them to UART module and USB_top module. These module send data via CDC/UART to host.</span></div><div><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\"><br /></span></div><h3 style=\"text-align: left;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">How to use?</span></h3><div><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">The output of UART/CDC are bytes. So to convert them to human readable format and hence allow easy debugging, a program fpga_debug.c has been provided which reads data from the fpga and then outputs data in correct format. </span></div><div><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\"><br /></span><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">To compile fpga_debug.c</span></div><div><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">&gt; cd tools</span></div><div><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">&gt; make</span></div><div><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\"><br /></span></div><div><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">To run debugging program</span></div><div><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">&gt; ./fpga_debug</span></div><div><br /></div><h4 style=\"text-align: left;\">How to add new debug data?&nbsp;</h4><div><ul style=\"text-align: left;\"><li>Route the data into debug_module</li><li>Break it into bytes and add to uart_byte_array</li><li>&nbsp;Change value of \"constant N_BYTES &nbsp;: integer\" appropriately</li><li>In fpga_debug.c add code to parse and output the new data</li></ul><div>You are done!<br /><h4 style=\"text-align: left;\">Output Bytes:</h4><div><span id=\"docs-internal-guid-9accb71d-e7dd-51eb-09c9-5221da483b43\"><br /><div dir=\"ltr\" style=\"margin-left: 0pt;\"><table style=\"border-collapse: collapse; border: none;\"><colgroup><col width=\"140\"></col><col width=\"484\"></col></colgroup><tbody><tr style=\"height: 0px;\"><td style=\"background-color: #bfbfbf; border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">Byte</span></div></td><td style=\"background-color: #bfbfbf; border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">Description</span></div></td></tr><tr style=\"height: 0px;\"><td style=\"border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">1</span></div></td><td style=\"border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">Device State</span></div></td></tr><tr style=\"height: 0px;\"><td style=\"border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">5:2</span></div></td><td style=\"border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">Resolution of Source</span></div></td></tr><tr style=\"height: 0px;\"><td style=\"border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">6</span></div></td><td style=\"border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">Input frame rate in fps</span></div></td></tr><tr style=\"height: 0px;\"><td style=\"border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">7</span></div></td><td style=\"border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">Output frame rate in fps</span></div></td></tr><tr style=\"height: 0px;\"><td style=\"border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">8</span></div></td><td style=\"border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">Frame write time in ms</span></div></td></tr><tr style=\"height: 0px;\"><td style=\"border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">9</span></div></td><td style=\"border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">Frame Processing Time in ms</span></div></td></tr><tr style=\"height: 0px;\"><td style=\"border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">10</span></div></td><td style=\"border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">No. of frames dropped for every frame processed</span></div></td></tr><tr style=\"height: 0px;\"><td style=\"border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">13:11</span></div></td><td style=\"border-bottom: solid #000000 1px; border-left: solid #000000 1px; border-right: solid #000000 1px; border-top: solid #000000 1px; padding: 7px 7px 7px 7px; vertical-align: top;\"><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-left: -1.5pt; margin-top: 0pt; text-align: justify; text-indent: -1.5pt;\"><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\">No. of bytes in a frame</span></div></td></tr></tbody></table></div></span></div><br /></div></div><div><br /></div><div><b>NOTE: </b>To use UART port, <a href=\"https://github.com/timvideos/HDMI2USB/wiki/Installing-Exar-Driver\">exar device driver should be installed</a>. But the driver does not allow CDC port to function along with it. So you can use either UART or CDC but not both.<br /><br /><h4 style=\"text-align: left;\"><a href=\"https://www.youtube.com/watch?v=naJ_AHqOFrQ&amp;feature=youtu.be&amp;noredirect=1\">Video</a></h4></div><div><br /></div><div><span style=\"font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;\"><br /></span></div></div><div class=\"author\">\n  <span>\n    <i>Originally posted on <a href=\"http://ajitmathewgsoc.blogspot.com/\">TimVideo GSoC 2014: MJPEG Optimisation</a></i>\n  </span>\n</div>\n"}