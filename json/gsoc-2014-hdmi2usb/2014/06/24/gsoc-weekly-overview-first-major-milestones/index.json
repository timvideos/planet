{"title":"[GSoC Weekly Overview]: First major milestones!","created_at":"2014-06-24 16:30:00 UTC","author":"Rohit (VGA Extension)","content":"<div dir=\"ltr\" style=\"text-align: left;\" trbidi=\"on\"><div dir=\"ltr\" id=\"docs-internal-guid-831f4a63-d27b-408c-3ebe-06151178959a\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">This week started exciting! First of all I couldn’t get any capture in my first attempt. And, if you see the </span><a href=\"http://dreamsxtrinsic.blogspot.com/2014/06/gsoc-daily-log-messy-capture-syncclock.html\" style=\"text-decoration: none;\"><span style=\"background-color: transparent; color: #1155cc; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline;\">reason</span></a><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\"> for that, you will start laughing! I flipped the code such that when the video *should* be displayed it is not displayed, instead it is ‘displayed’ when it shouldn’t and when one cannot see it. Big #Facepalm</span></div><br /><h2 dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;\"><span style=\"background-color: transparent; color: black; font-family: 'Trebuchet MS'; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;\">Messy Capture!</span></h2><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">The first glimpse of anything sane or anything colorful right at the start of week instilled excitement. Although it was not as expected being quite messed up, it did mean that the AD9984A (my VGA capturing IC! remember?) was working fine. Also, from the captured output shown on HDMI I could think of few possible reasons for the message capture output. I’ve a recorded a sample for the benefit of blog readers :D</span></div><br /><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">[Video: </span><a href=\"https://www.youtube.com/watch?v=EbOzHu6HjCA&amp;feature=youtu.be\" style=\"text-decoration: none;\"><span style=\"background-color: transparent; color: #1155cc; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline;\">https://www.youtube.com/watch?v=EbOzHu6HjCA&amp;feature=youtu.be</span></a><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">]</span></div><br /><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">From the video, anyone with some knowledge of Digital Electronics can figure out that issue is mostly related to sync/clock. So my next target was to correct this.</span></div><br /><h2 dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;\"><span style=\"background-color: transparent; color: black; font-family: 'Trebuchet MS'; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;\">Sane Output!</span></h2><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">After 1.5 days of </span><a href=\"http://dreamsxtrinsic.blogspot.com/2014/06/gsoc-daily-log-major-improvement.html\" style=\"text-decoration: none;\"><span style=\"background-color: transparent; color: #1155cc; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline;\">tinkering around</span></a><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\"> with code, I got first output which closely resembled the VGA output. Remember how previously talked about that Blue and Red signals were interchanged in the PCB? Well, that showed up now, with Yellow being rendered as Cyan! Fixing this was simple one line code modification. </span><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;\">Now, this was a time to rejoice! Hurray! </span></div><br /><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">Once the jubilation settled, it was time to look closely. There was quite a large amount of flickering in the output. The default culprits I assumed once again to be an unstable clock and irregular HSYNCs &amp; VSYNCs. &nbsp;Also, I kept the possibility of a bug in my code open.</span></div><br /><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">Once again for the readers, I have video captures of the results.</span></div><br /><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">[Video: </span><a href=\"http://youtu.be/8NJKg4NfHsk\" style=\"text-decoration: none;\"><span style=\"background-color: transparent; color: #1155cc; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline;\">http://youtu.be/8NJKg4NfHsk</span></a><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">]</span></div><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">[Video: </span><a href=\"http://youtu.be/fgf4bPwXmHM\" style=\"text-decoration: none;\"><span style=\"background-color: transparent; color: #1155cc; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline;\">http://youtu.be/fgf4bPwXmHM</span></a><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">]</span></div><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">[Video: </span><a href=\"http://youtu.be/KBpUmU1HUuM\" style=\"text-decoration: none;\"><span style=\"background-color: transparent; color: #1155cc; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline;\">http://youtu.be/KBpUmU1HUuM</span></a><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">]</span></div><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">[Video: </span><a href=\"http://youtu.be/cR2D-_gYayQ\" style=\"text-decoration: none;\"><span style=\"background-color: transparent; color: #1155cc; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline;\">http://youtu.be/cR2D-_gYayQ</span></a><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">]</span></div><br /><h2 dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;\"><span style=\"background-color: transparent; color: black; font-family: 'Trebuchet MS'; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;\">Period of frustration</span></h2><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">Initially I thought that it would be easy to remove the flickering but it was not. I rewrote the whole code more than 20 times with different capture mechanisms thinking maybe the fault was with the code, but the output refused to budge. In some cases, flickering would reduce, in some case they would increase greatly. Even oversampling code didn’t work at all(no output). It was then that I decided to first check the clock in more detail. Driving the HDMI code with Jahanzeb’s test pattern with only pixel clock sourced from AD9984A gave at least one concrete evidence that Pixel Clock was not very stable. Maybe due to high frequency and long route from AD9984A to FPGA though the VHDCI connector? There were no flickering but the test image was shaking slightly. </span></div><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">Probing the AD9984A status registers revealed that number of HSYNCs per VSYNC were getting detected correctly.</span></div><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">Once again I thought of more tests (one test was even designed during a dream, one can imagine how frustrated I was!). Alas, all of them failed</span></div><br /><h2 dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;\"><span style=\"background-color: transparent; color: black; font-family: 'Trebuchet MS'; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;\">Ray of hope!</span></h2><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">I remembered my mentor Tim telling me about Ajit (a fellow GSoCer, </span><a href=\"https://docs.google.com/spreadsheets/d/1f-rBfR98f_ZZNIB7GFV79CGSHQNpj47uOU0JDwOJnV8/edit#gid=62369278\" style=\"text-decoration: none;\"><span style=\"background-color: transparent; color: #1155cc; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline;\">his blog</span></a><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">) having written a code for using the Atlys’ onboard USB-Serial interface. I pinged Ajit on IRC and he instantly replied. Incidentally I suppose, we happen to enjoy working all-night only :D Even Ayush(</span><a href=\"http://ptzfortimvideos-gsoc14.blogspot.com/\" style=\"text-decoration: none;\"><span style=\"background-color: transparent; color: #1155cc; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline;\">his blog</span></a><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">) enjoys working all-night! Back to topic, Ajit replied quickly my doubts and told me to try his code on Windows (due to Exar’s old linux drivers not functioning properly). I switched to windows and used his code from </span><a href=\"https://github.com/ajitmathew/HDMI2USB/commit/559f0156d70a2b23686997201bf78d41881fac20\" style=\"text-decoration: none;\"><span style=\"background-color: transparent; color: #1155cc; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline;\">here </span></a><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">in a standalone project. Once working correctly, I added the code to my VGA capture project and modified my code to output debug value over UART. And, voila! I started getting some useful debug information from the board in real-time! Now, instead of firing in darkness, I could do systematic debugging. Head over to my </span><a href=\"http://dreamsxtrinsic.blogspot.com/2014/06/gsoc-daily-log-trails-errors-part-2.html\" style=\"text-decoration: none;\"><span style=\"background-color: transparent; color: #1155cc; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline;\">blog snippet</span></a><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\"> on some results from first run of UART debugging enabled code.</span></div><br /><h2 dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;\"><span style=\"background-color: transparent; color: black; font-family: 'Trebuchet MS'; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;\">Upcoming Week:</span></h2><div dir=\"ltr\" style=\"line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">I’ve some conflicting targets for upcoming week. On one hand I’m thinking of getting the capture right *perfectly* then proceeding to integration with current HDMI2USB code. On the other hand, I’m thinking of first integrating the code with current HDMI2USB code and then remove the flickering. My reason for even considering the second option is that, I think since the USB streaming happens at very slow rate 15-30fps max. compared to the HDMI output @60fps, the flickering would not be a major bottleneck. This would also make the project closer to the intended target of integrating with HDMI2USB.</span></div><span style=\"background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;\">But, other argument is that getting the capture perfect should be first priority, and then integrating with HDMI2USB code. I’ll have to discuss this with my mentor in this regard. </span></div><div class=\"author\">\n  <span>\n    <i>Originally posted on <a href=\"http://dreamsxtrinsic.blogspot.com/\">Dreams eXtrinsic</a></i>\n  </span>\n</div>\n"}