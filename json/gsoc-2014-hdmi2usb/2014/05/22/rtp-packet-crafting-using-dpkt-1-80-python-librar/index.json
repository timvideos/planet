{"title":"RTP packet crafting using dpkt-1.80 Python library","created_at":"2014-05-22 03:50:00 UTC","author":"Tariq (Ethernet Support)","content":"<span style=\"font-size: large;\">Installing <a href=\"http://code.google.com/p/dpkt/downloads/list\">dpkt-1.80.tar.gz</a> was trickier than i thought. Python is not easy to master. I always learn something new when i start to work on it. The problem with dpkt is the poor documentation right from the start. Installation was quite an issue for me but later in the afternoon, i figured out the correct way to do it. Before that i was trying to import modules from the dpkt directory but something in the code would keep on breaking. Dpkt project suffers from poor documentation of the source code as well and lack of examples to use the library.I had to try out a couple of things before i was able to create the RTP packets. Part of this effort was googling looking for code samples using dpkt. Unfortunately, there were not many.</span><br /><span style=\"font-size: large;\">Anyway, here is the RTP code that i have coded</span><br /><span style=\"font-size: large;\"><br /></span><br /><span style=\"color: blue;\">#trying to send rtp packet</span><br /><span style=\"color: blue;\">#by Tariq B. Ahmad</span><br /><span style=\"color: blue;\"># 5/21/2014</span><br /><span style=\"color: blue;\"><br /></span><span style=\"color: blue;\">import dpkt</span><br /><span style=\"color: blue;\">import socket</span><br /><span style=\"color: blue;\"><br /></span><span style=\"color: blue;\">rtp_pkt = dpkt.rtp.RTP()</span><br /><span style=\"color: blue;\">rtp_pkt.data = '''HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HelloWorldHelloWorldHelloWorldHelloWorld</span><br /><span style=\"color: blue;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '''</span><br /><span style=\"color: blue;\"><br /></span><span style=\"color: blue;\">udp_pkt = dpkt.udp.UDP(sport=11111,dport=11112)</span><br /><span style=\"color: blue;\">udp_pkt.data = rtp_pkt.data</span><br /><span style=\"color: blue;\">udp_pkt.ulen += len(udp_pkt.data)</span><br /><span style=\"color: blue;\"><br /></span><span style=\"color: blue;\">ip_pkt = dpkt.ip.IP(id=0, src='\\x01\\x02\\x03\\x04', dst='\\xc0\\xa8\\x7a\\x01', p=17) # p=17 for udp</span><br /><span style=\"color: blue;\">ip_pkt.data = udp_pkt.data</span><br /><span style=\"color: blue;\">ip_pkt.len += len(ip_pkt.data)</span><br /><span style=\"color: blue;\"><br /></span><span style=\"color: blue;\">s = socket.socket(socket.AF_INET, socket.SOCK_RAW, dpkt.ip.IP_PROTO_UDP)</span><br /><span style=\"color: blue;\">s.connect(('192.168.122.1', 11112))</span><br /><span style=\"color: blue;\">#print str(ip_pkt)</span><br /><span style=\"color: blue;\">sent = s.send(str(ip_pkt))</span><br /><span style=\"color: blue;\"><br /></span>  <span style=\"color: blue;\">print 'sent %d bytes' % sent</span><br /><span style=\"color: blue;\"><br /></span><br /><span style=\"color: blue;\"><br /></span>Here is the output when you run the script. You have to be the root user in Linux to use socket functionality.<br /><br /><span style=\"color: orange;\">sent 1554 bytes</span><br /><div><br /></div><br />I tried to capture this using Wireshark by listening to the interface on 192.168.122.1 but Wireshark could not capture this. I have googled this and other people have reported the same issue.<br /><br />If i have some time tomorrow, i shall use Scapy library to see if i can do the same or better with Scapy.<br />Cheerz and tomorrow is MyHDL day<br /><br /><br /><br />I also received my Xilinx Atlys board today !!!<div class=\"author\">\n  <span>\n    <i>Originally posted on <a href=\"http://hdmi2ethernet.blogspot.com/\">GSOC 2014</a></i>\n  </span>\n</div>\n"}